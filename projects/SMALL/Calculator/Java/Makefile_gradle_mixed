#
# A simple Makefile
#

######

include $(PATSHOME)/share/atsmake-pre.mk


######
#
# either use gradle or ./gradlew (wrapper script)
#
GRADCMD=gradle
#GRADCMD=./gradlew
#
######

######
#
# You may need to change this:
#
JNIincl=/usr/lib/jvm/java-7-openjdk-amd64/include
#
######

######
#
# Should match buildDir in gradle
#
ODIR=./build
#
######


all:: Calculator

######

Calculator:: $(ODIR)/native.h
Calculator:: $(ODIR)/Calculator.class
Calculator:: $(ODIR)/libCalculator_dats.so

######

$(ODIR)/Calculator.class $(ODIR)/native.h :; $(GRADCMD) build
$(ODIR)/Calculator_dats.o: Calculator.dats; \
cd $(ODIR); \
$(PATSCC) -D_GNU_SOURCE $(INCLUDE) $(INCLUDE_ATS) \
  -IIATS $(PATSHOME)/contrib -I$(JNIincl) -DATS_MEMALLOC_LIBC -fPIC \
  -c ../Calculator.dats -o Calculator_dats.o

######

$(ODIR)/libCalculator_dats.so: $(ODIR)/Calculator_dats.o ; \
 gcc -shared -o $@ -Wl,-soname,$@ $< -ldl

######

RMF=rm -f

######

clean::; $(RMF) *~
clean::; $(RMF) Calculator_dats.c

cleanall:: clean
cleanall::; $(GRADCMD) clean


######

###### end of [Makefile] ######
